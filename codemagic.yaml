workflows:
  ios-build:
    name: iOS Build Workflow

    labels:
      - QA

    instance_type: mac_mini_m2
    max_build_duration: 60

    inputs:
      PROJECT_NAME:
        description: "Howl"
        default: "Howl"

      SCHEME:
        description: "Howl"
        default: "Howl"

    environment:
      flutter: stable  # Remove if you're not using Flutter
      xcode: latest

    cache:
      cache_paths:
        - ~/.pub-cache  # If using Flutter, otherwise remove

    triggering:
      events:
        - push
        - pull_request

      branch_patterns:
        - pattern: '*'  # Include all branches
          include: true
          source: true

      cancel_previous_builds: false

    scripts:
      - name: Install Dependencies
        script: |
          echo "Installing dependencies..."
          # Uncomment the next line if using CocoaPods for dependency management
          # pod install

      - name: Build the App
        script: |
          echo "Building the app..."
          xcodebuild -project Howl.xcodeproj -scheme Howl -configuration Release archive -archivePath $PWD/build/Howl.xcarchive

      - name: Export .ipa File
        script: |
          echo "Exporting .ipa file..."
          xcodebuild -exportArchive -archivePath $PWD/build/Howl.xcarchive -exportOptionsPlist ExportOptions.plist -exportPath $PWD/build

    artifacts:
      - build/**/*.ipa
      - build/**/*.dSYM.zip

    publishing:
      email:
        recipients:
          - spoinkosgithub@gmail.com

      scripts:
        - echo 'Post-publish script'
